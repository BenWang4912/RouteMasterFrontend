@model RouteMasterFrontend.Models.ViewModels.AttractionVMs.AttractionDetailVM

@{
    ViewData["Title"] = "Details";
}

@section Styles{
    <style>
        p {
            font-size:1.4em;
        }
        iframe {
            width: 100%;
        }
    </style>
}

<div class="container w-75 border rounded my-5">

    <div class="mt-3 mb-5">
        <div id="carouselExampleIndicators" class="carousel slide">
            <div class="carousel-indicators">
                @for(int i = 0; i< Model.Images.Count(); i++)
                {
                    if(i == 0)
                    {
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to=@i class="active" aria-current="true" aria-label="Slide @(i+1)"></button>
                    }
                    else
                    {
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to=@i aria-label="Slide @(i+1)"></button>
                    }
                }
                
            </div>
            <div class="carousel-inner">
                @for(int i = 0; i < Model.Images.Count(); i++)
                {
                    if(i == 0)
                    {
                        <div class="carousel-item active">
                            <img src="~/AttractionImages/@Model.Images[i]" class="d-block w-100" style="height:500px; object-fit:cover" alt="...">
                        </div>
                    }
                    else
                    {
                        <div class="carousel-item">
                            <img src="~/AttractionImages/@Model.Images[i]" class="d-block w-100" style="height:500px; object-fit:cover" alt="...">
                        </div>
                    }
                }
               
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>

    <div class="mb-1">
        <h1><strong>@($"{Model.Name} ")</strong><span class="badge bg-info">@Model.AttractionCategory</span></h1>
    </div>
    
    <div class="mb-5">
        <h3>@($"{Model.Region} {Model.Town}")</h3>
    </div>
    
    <div class="mb-5">
        <h5>
            @($"{Model.Score}")
            @for (int i = 1; i <= 5; i++)
            {
                @if (i <= Math.Round(Model.Score))
                {
                    <i class="fa-solid fa-star"></i>
                }
                else
                {
                    <i class="fa-regular fa-star"></i>
                }
            }
            @($"({Model.ScoreCount}) | 平均停留{Model.Hours}小時({Model.HoursCount}) | 平均花費{Model.Price}元({Model.PriceCount}) | 點擊次數 : {Model.Clicks}次")
        </h5>
    </div>

    <div class="mb-5">
        <h5>
            @foreach (var tag in Model.Tags)
            {
                <span class="badge bg-primary text-white">@tag</span>
            }
        </h5>
    </div>

    <div class="mb-5">
        <div class="mb-3">
            <h3>景點介紹<br></h3>
        </div>
        @Html.Raw(Model.Description)
    </div>

    <div class="mb-5">
        <div class="mb-3">
            <h3>地圖<br></h3>
        </div>
        
        @Html.Raw(Model.Website)
    </div>
    
    <div class="mb-3">
        <button class="btn btn-primary" id="addToFavoriteButton">加入我的最愛</button> |
        <a asp-action="Index" class="btn btn-secondary">返回列表</a>
    </div>
</div>




@section Scripts{
    
    <script src="https://kit.fontawesome.com/0295eb5403.js" crossorigin = "anonymous" ></script>

    <script>
        document.getElementById("addToFavoriteButton").addEventListener("click", function () {
            var attractionId = @Model.Id;

            $.ajax({
                url: '@Url.Action("AddToFavorite", "Attractions")',
                type: 'POST',
                data: { id: attractionId },
                success: function (result) {
                    console.log("AJAX success:", result); // 檢查 AJAX 回傳的結果
                    if (result.success) {
                        alert("已加入最愛");
                    }
                    else {
                        alert("請先登入");
                    }
                }
            });
        });
    </script>
}